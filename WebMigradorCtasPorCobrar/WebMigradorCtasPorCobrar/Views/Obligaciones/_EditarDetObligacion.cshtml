@model WebMigradorCtasPorCobrar.Models.Entities.Migracion.Obligacion
@Scripts.Render("~/bundles/jqueryval")

@{
    string tipoObs = ViewBag.TipoObserv;
    string observ_descrip = ViewBag.Observacion;
}

<div class="col-12">
    <div class="row">
        <div class="col-12">
            @using (Html.BeginForm("SaveDetalle", "Obligaciones", new { area = "" }, FormMethod.Post, new { id = "form_ec_det" }))
            {

            }
        </div>
    </div>
    <div class="row mt-4">
        @*@Html.Partial("_OtrasTablas", Model)*@
    </div>
</div>

<script>
    $('#error_title').hide();
    $('#error_descrip').html('@observ_descrip');

    $("#btnsubmit").on('click', function (event) {
        event.preventDefault();
        var form = $('#form_cpdes');
        Swal.fire({
            title: "¡Atención, posible incosistencia!",
            text: "",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: '#ff830f',
            cancelButtonColor: '#3c3c3c',
            confirmButtonText: "Sí, guardar cambios",
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: form[0].action,
                    type: 'POST',
                    data: form.serialize(),
                    cache: false,
                    beforeSend: function () {
                        Load();
                    },
                    success: function (data) {
                        Submited();
                        $('#div_msg').html(data);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#form_cpdes').append(`<div class="col-12">
                                                    <div id="div-alert" class="mt-3">
                                                        <div class="text-center alert alert-danger">
                                                            <i class="fa fa-times">&nbsp;</i>${jqXHR.responseText}
                                                        </div>
                                                    </div>
                                                </div>`);
                    },
                    complete: function () {
                        $('#loading').hide();
                    }
                })
            };
        });
    });

    $("form").submit(function () {
        if (parseInt($("#submited").val()) > 0) {
            return false;
        }
        else {
            $('#error_descrip').html('');
            $('#error_title').show();
        }
    });

    $('#btnCancel').on('click', function () {
        $('#edit-target').hide()
        $('#tabla-errores').show()
        $('#error_title').show();
        $('#error_descrip').html('');
    })
</script>